<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://msocialverse.com/wp-content/uploads/2024/03/cropped-FavIcon-32x32.png" sizes="32x32">
    <link rel="icon" href="https://msocialverse.com/wp-content/uploads/2024/03/cropped-FavIcon-192x192.png" sizes="192x192">
    <title>mSocial Marketing Agency</title>
    <style>
        body, html {
            margin: 0;
            border:none;
            background-color: #f0f0f0;
        }
        .container {
            position: relative;
            min-width: 50%;
            width:800px;
            max-width:95%;
            height:100%;
            /* background:red; */
            left:50%;
            transform: translateX(-50%);
        }
        .section {
            position: relative;
            width:100%;
            height:auto;
            padding:5px;
            /* background-color: yellow;
            border:1px solid black; */
            box-sizing: border-box;
        }
        .video-wrapper {
            left: 50%;
            width: 90%;
            transform: translateX(-50%);
            /* background:yellow; */
        }
        .logo
        {
            position: relative;
            padding-top:20px;
            left: 50%;
            width:30%;
            max-width: 400px;
            min-width:200px;
            transform: translateX(-50%);
            /* background:green; */
        }
        .logo img
        {
            width:100%;
            height:auto;
        }
        .tag-line
        {
            width:100%;
            height:auto;
            color:black;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: clamp(3vh, 4vw, 3.2vh);
            font-weight:bold;
            text-align: center;
            padding:20px;
            padding-top:50px;;
        }
        .hint-line
        {
            width:100%;
            height:auto;
            left: 50%;
            color:black;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: clamp(2vh, 3vw, 2.5vh);
            font-weight:400;
            text-align: center;
            transform: translateX(-50%);
            padding-bottom:60px;
            display:none;
        }
        .button-wrapper
        {
            padding-top:20px;
        }
        .button-wrapper button {
            position: relative;
            padding: 15px 30px;
            font-size: 16px;
            cursor: pointer;
            border:none;
            color:white;
            font-size: clamp(2.5vh, 3.5vw, 2.8vh);
            font-weight:bold;
            border-radius: 4px;
            background-color: rgba(255, 51, 0, 0.856);
            left: 50%;
            transform: translateX(-50%);
        }
        .button-wrapper button:hover {
            background-color: rgba(0, 156, 34, 0.877);
        }
        /* Media queries for different screen sizes */
        @media (max-width: 768px) {
            .tag-line {
                font-size: clamp(2vh, 3vw, 2.4vh);
            }
            .hint-line {
                font-size: clamp(1.5vh, 2.5vw, 2vh);
            }
            .button-wrapper button {
                font-size: clamp(2vh, 3vw, 2.3vh);
            }
        }
    </style>
    <script>
        function getEmailFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('wemail');
        }

        
        function RecordVisitorLandedOnPage() {
            const email = getEmailFromURL();
            if (!email) {
                console.log('Email parameter is missing in the URL.');
                return;
            }

            const url = `https://462dg3vi3e42y7tudtwmtdh5nu0rnpus.lambda-url.ap-south-1.on.aws/?wemail=${email}&categ=8494`;

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text(); // Expecting plain text response
                })
                .then(data => {
                    if (data === 'success') {
                       console.log("Visitor recorded");
                    } else {
                        throw new Error('Unexpected response data');
                    }
                })
                .catch(error => {
                    console.log('An error occurred. Please try again later.');
                });
        }
        RecordVisitorLandedOnPage();

        function redeemOffer() {
            const email = getEmailFromURL();
            if (!email) {
                console.log('Email parameter is missing in the URL.');
                return;
            }


            const url = `https://462dg3vi3e42y7tudtwmtdh5nu0rnpus.lambda-url.ap-south-1.on.aws/?wemail=${email}&categ=8497`;

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                        offerRedeemed = false;
                    }
                    return response.text(); // Expecting plain text response
                })
                .then(data => {
                    if (data === 'success') {
                        offerRedeemed = true;
                        console.log("Offer Received");
                    } else {
                        offerRedeemed = false;
                        throw new Error('Unexpected response data');
                    }
                })
                .catch(error => {
                    alert('An error occurred. Please try again later.');
                    offerRedeemed = false;
                });
        }

        function DirectToBookCall()
        {
            if (watchedPercentage > 75)
            {
                window.location.href = 'https://calendly.com/msocialverse/call-with-msocial';
            }
            else
            {
                const message = document.querySelector('.hint-line');
                message.style.display = 'block';
            }

        }

    </script>
</head>
<body>
    <div class="container">
        <div class="logo section">
            <img src="images/logo.png">
        </div>
        
        <div class="tag-line section">Grow your business by 300% in just 6 Months</div>
        <div class="video-wrapper section">
            <script src="https://fast.wistia.com/embed/medias/8wtjtx8fzu.jsonp" async></script>
            <script src="https://fast.wistia.com/assets/external/E-v1.js" async></script>
            <div class="wistia_responsive_padding" style="padding:56.25% 0 0 0;position:relative;">
                <div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%;">
                    <div class="wistia_embed wistia_async_8wtjtx8fzu seo=true videoFoam=true" style="height:100%;position:relative;width:100%">
                        <div class="wistia_swatch" style="height:100%;left:0;opacity:0;overflow:hidden;position:absolute;top:0;transition:opacity 200ms;width:100%;">
                            <img src="https://fast.wistia.com/embed/medias/8wtjtx8fzu/swatch" style="filter:blur(5px);height:100%;object-fit:contain;width:100%;" alt="" aria-hidden="true" onload="this.parentNode.style.opacity=1;" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="button-wrapper section">
            <button onclick="DirectToBookCall()">Book a Call</button>
        </div>
        <div class="hint-line section">Please watch the full video to Book a Call</div>
        
        
    </div>

    <script>
        var watchedPercentage = 0;
        var offerRedeemed = false;
        function trackVideoProgress(video) {
            const parts = 30;
            const updateFrequency = 1; // Check every second
            const cookieName = 'videoProgress';
            
            // Initialize or retrieve the watched parts from the cookie
            let watchedParts = getCookie(cookieName) || '0'.repeat(parts);
            watchedPercentage = calculateWatchedPercentage(watchedParts);
            console.log(watchedPercentage);

            video.addEventListener('timeupdate', function() {
                const currentTime = video.currentTime;
                const duration = video.duration;
                const partLength = duration / parts;
                const partIndex = Math.floor(currentTime / partLength);
                
                if (watchedParts[partIndex] === '0') {
                    watchedParts = setCharAt(watchedParts, partIndex, '1');
                    setCookie(cookieName, watchedParts, 365); // Store the updated cookie for 1 year
                    watchedPercentage = calculateWatchedPercentage(watchedParts);
                    console.log(watchedPercentage);
                    if (offerRedeemed == false && watchedPercentage > 75)
                    {
                        offerRedeemed = true;
                        redeemOffer();
                    }
                }

            });

            video.addEventListener('ended', function() {
                console.log('Video ended! You watched ' + calculateWatchedPercentage(watchedParts) + '% of the video.');
            });

            function calculateWatchedPercentage(partsString) {
                const watchedCount = partsString.split('').filter(char => char === '1').length;
                return (watchedCount / parts) * 100;
            }

            function setCharAt(str, index, chr) {
                if (index > str.length - 1) return str;
                return str.substring(0, index) + chr + str.substring(index + 1);
            }

            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }

            function setCookie(name, value, days) {
                const d = new Date();
                d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
                const expires = `expires=${d.toUTCString()}`;
                document.cookie = `${name}=${value}; ${expires}; path=/`;
            }
        }

        // Function to continuously check for the video element
        function checkForVideo() {
            const video = document.querySelector('video');
            if (video) {
                trackVideoProgress(video);
            } else {
                setTimeout(checkForVideo, 500); // Check again after 500ms
            }
        }

        // Start checking for the video element
        checkForVideo();

    </script>
</body>
</html>
